## 操作场景

云数据库 Redis 集群版旧版本（2018年1月1日之前购买的集群版为旧集群版）由于版本较低、架构老旧，存在一定的稳定性风险，为了保证业务最大的稳定性，我们建议您近期尽快迁移到全新的 Redis 4.0集群版。
升级到新版本将能够体验更灵活的规格配置，更高的性能以及更完善的功能，我们将于2018年10月15日到2018年12月5日协助您将 Redis 旧集群版实例升级至 Redis 2.8主从版或4.0集群版，2.8主从版的介绍请参见 [Redis 2.8主从版](https://cloud.tencent.com/document/product/239/17950)，4.0集群版介绍请参见 [Redis 4.0集群版](https://cloud.tencent.com/document/product/239/18336)。
> ?Redis 集群版（旧版本）实例无法热迁移到主从版或者集群版， 为保证迁移过程不丢失数据，从迁移开始时，需要停止对集群版 CRS 的写入。

## 前提条件
- 已购买好新的主从版或者集群版实例。
>?如果数据量小于16GB，并且后续数据增长不超过60GB，QPS 不超过5万，建议使用Redis 2.8主从版，否则建议购买 Redis 4.0集群版，Redis 4.0集群版完全兼容Redis旧集群版。
Redis 2.8主从版刊例价76元/GB/月，Redis 4.0集群版刊例价84元/GB/月，可以根据实际情况进行选择。
- 已备好一台 CVM 供数据导入使用，CVM 的磁盘的空间需要足够存储现有实例的数据。
- 已安装好数据导入工具 crs-port，工具使用说明和下载地址请参见 [工具地址](https://cloud.tencent.com/document/product/239/611)。

## 操作步骤
1. 停止业务写入Redis集群版（旧版本）实例。
2. 创建 Redis 集群版（旧版本）实例的备份数据，等待实例完成备份，备份时长根据数据量而定，备份完成后会生产一个 RDB 文件。
![](https://main.qcloudimg.com/raw/afe562ddc91ac10f56d714ad62c94777.png)
3. 数据备份完成后，在备份列表中可以看到之前备份的文件，复制内网地址，从内网 CVM 下载备份文件，**不支持跨可用区下载**。
![](https://main.qcloudimg.com/raw/2f63deeea54d0eb2666b85f52dfcbec1.png)
4. 初始化新购的 Redis 2.8主从版或 Redis 4.0集群版的密码，使用 crs-port 工具执行一些操作将下载的 RDB 文件导入到新的实例。
```
crs-port restore -n 16 -i /data/dump.rdb -t 192.168.0.1:6379 -A passwd
```
5. 数据导入完成后，通过控制台确认数据导入成功，可以查看实际的内存使用量。
![](https://main.qcloudimg.com/raw/436b86476c50f5b4591e8247e420856f.png)
6. 迁移应用到新实例，**只需要将代码中的旧集群版的 IP 更新为新实例的 ID 即可**。
